<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, height=device-height, minimum-scale=1, maximum-scale=1, initial-scale=1">
		<title>Camera</title>
	</head>
	<style>
		body
		{
			background-image: url("https://drive.google.com/thumbnail?id=1ZfsvaQkasDi7TL7Uk_PLVmxyxKkgHqSG");
			background-repeat: no-repeat;
		}
		button
		{
			width: 80vw;
			height: 5vh;
			background: cyan;
			color: white;
			border: none;
			border-radius: 1vh;
			font-family: Times New Roman;
			font-size: 2vh;
		}
		.button
		{
			position: absolute;
			left: 20vw;
			width: 60vw;
		}
		.button1
		{
			display: none;
			position: absolute;
			left: 20vw;
			width: 60vw;
		}
		.label
		{
			display: inline-block;
			width: 30vw;
			height: 2vh;
			background: cyan;
		}
		.text
		{
			width: 70vw;
			height: 4vh;
		}
		main
		{
			display: block;
			justify-content: center;
			align-items: center;
		}
		#reader
		{
			width: 100vw;
		}
		#result
		{
			display: none;
			font-size: 2vh;
		}
		#bill
		{
			display: none;
			justify-content: center;
			align-items: center;
			text-align: center;
			font-size: 10px;
		}
		table
		{
			margin-left: auto;
			margin-right: auto;
			border-collapse: none;
			font-size: 10px;
		}
	</style>
	<script src="https://raw.githubusercontent.com/Quan2000/printer/refs/heads/main/html5-qrcode.min.js"></script>
	<script src="https://raw.githubusercontent.com/eKoopmans/html2pdf.js/refs/heads/main/dist/html2pdf.bundle.min.js"></script>
	<body data-rsssl=1>
		<main>
			<div id="reader"></div>
			<div id="result">
				<label class="label">Mã chuyến đi</label>
				<input type="text" class="text" id="code" />
				<br>
				<br>
				<label class="label">Tên tài xế</label>
				<input type="text" class="text" id="name" />
				<br>
				<br>
				<label class="label">Biển số xe</label>
				<input type="text" class="text" id="plate" />
				<br>
				<br>
				<label class="label">Quãng đường</label>
				<input type="number" class="text" id="distance" />
				<br>
				<br>
				<label class="label">Phí</label>
				<input type="number" class="text" id="fee" />
				<br>
				<br>
				<label class="label">Dịch vụ thêm</label>
				<input type="number" class="text" id="addon" />
				<br>
				<br>
				<label class="label">Phụ phí</label>
				<input type="number" class="text" id="surcharge" />
				<br>
				<br>
				<label class="label">Giảm giá</label>
				<input type="number" class="text" id="discount" />
				<br>
				<br>
				<button class="button" onclick="create()">Tạo hóa đơn</button>
			</div>
			<div id="bill">
				<p>	
					<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEgAAAAbCAYAAADf98keAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAhdEVYdENyZWF0aW9uIFRpbWUAMjAyNTowOToxNiAwNjo1MzoxMYPaRo8AAARdSURBVFhH7ZlbKHxfFMcPxiVeJkVySZJ7E+VSXpRLXigpYngRSTwQUYooUuJJeFJ4kDwweHAroRSliEREMblTRPGE9beWvc9/nzNnjF8/D7/RfGp19rrsGfs7+6x9xjjBB5IDqzizqwMrOASywY/fYlNTU5LJZJLMZrOk0+mk9/d3aWVlhWWV6PV6yWg0SpWVlZLBYGDRfwwU6Cc4Pz8HJycnFNumfQgCLy8vbOa/zY8IdHl5qSmEaHFxcbC6uspm2A9/LdDZ2ZmmINxiY2Ph6OiIVdsfJFBdXZ1iUTk5OTAzM0MFtnB3d1fMFW1kZIRV2S/yDsIeol5gUlISy2qTn59vMYfb6+srq7JvFLeYVi8JDg5mWSVra2sWtdzsVZzn52eLO8eiB3V2dlosuLe3l2X/R13DbXp6mlXYJzc3N2z0iWaT1lq4eCzjMa1Vk5GRwSp+D5oCDQ0NWSw+JiaGcngiqXPc7u7uqOY3oSkQol58UVERxV1dXS1yaOnp6ZT/bVgVqLS0VF58WVkZxVJTUxWiiHZ7e0s1vw2rAo2NjdHCFxcXyU9LS7MQhVtKSgrVIFtbW+Dt7Q1hYWHQ09NDMdx9kZGR4O/vTz4HHxOioqIgPDycRT6Jj4+n+bW1teQ/PDxAQEAAnaj7+/uQmJgIoaGh0N7eTvnr62sIDAyk/Pr6OsWQtrY2iIiIgOjoaCgpKYGnpyeKY11ISAjMzs6SjzQ2NtL7Zmdns8gnVgXiHB8ff/kwiKZG3Gl9fX3yeHBwkFUA9SseR5uYmGAZ5e2NH9DHF17Z39zclMfl5eVUj7uXxxYWFiiWkJAgx0RD1P7p6anse3h4UIyjKVBNTQ1UV1eDr6+v4sW0DD8lLdR1+AeL4OuLeR8fH5YBcHFxUeQODw/l8fb2Nri5udE4Ly8PzGYzicLzfMdzf2lpiXyTyURXhOfQUGTcxdzX6/Ws6hNNgZaXlxUvYs08PT3ZDEs2NjYUtWp4PDMzUx7v7e1RTi2Q6IsCaRkXCG85MY4t4urqinJiXG3fEggpLi7WfAHR3t7eWLUlLS0tilr8UsuZnJyU44iXlxeNCwsLyeeCYN/hddy+KxAyOjoKycnJijzCx3Nzc/K4oaGBrt8WCOGTtQx3mTXu7+8153D8/Pw082iITqej8c7ODlRVVSnyokD19fVUjzuD57lAFRUV0NzcDI+Pj9SceV7sfUhQUBD09/fD8PAwxf5IIPGNReNb1Rr8WQmv+ATO5+FJIn7fw76DJwc+hPIYNnW+o3jfEHuE2KTx9ZCLiws5hgLhqcd90Xif4z6yu7tL146ODorh3yzypUDIyckJGI1GOhrxKLQFfwrHNxofH6cYHue4aDwhmpqa6Ko+LfCTxJqsrCwwGAzg7OwMAwMDlMMFYz3+xxJ3EN56uMu6u7spLwp0cHBAMaSrq4tERGttbWVRgIKCAsjNzWXeJ/Pz8xTHA0rE8bOPDRy/atjAIZANHAJ9iST9Bw5Kdz6pqKLSAAAAAElFTkSuQmCC" />
					<br>
					<b>CÔNG TY CỔ PHẦN DI</b>
					<br>
					<b>CHUYỂN XANH VÀ THÔNG</b>
					<br>
					<b>MINH GSM</b>
					<br>
Hotline: 1900 2088 | Email
					<br>
cskh@xanhsm.com
					<br>
..............................................................................................
					<br>
					<table>
						<tr>
							<td width=130px align="left">Driver name/Tên tài xế</td>
							<td width=50px align="right" id="name1"></td>
						</tr>
						<tr>
							<td width=130px align="left">Plate number/Biển số xe</td>
							<td width=50px align="right" id="plate1"></td>
						</tr>
					</table>
...............................................................................................
					<br>
					<table>
						<tr>
							<td width=120px align="left">Date time/Ngày in</td>
							<td width=50px align="right" id="time1"></td>
						</tr>
						<tr>
							<td colspan="2" align="left">Mã chuyến đi</td>
						</tr>
						<tr>
							<td colspan="2" align="left" id="code1"></td>
						</tr>
					</table>
...............................................................................................
					<br>
					<table>
						<tr>
							<td width=130px align="left">Distance/Quãng đường</td>
							<td width=50px align="right" id="distance1"></td>
						</tr>
						<tr>
							<td width=130px align="left">Fee/Phí</td>
							<td width=50px align="right" id="fee1"></td>
						</tr>
						<tr>
							<td width=130px align="left">Addon fee/Dịch vụ thêm</td>
							<td width=50px align="right" id="addon1"></td>
						</tr>
						<tr>
							<td width=130px align="left">Surcharge/Phụ phí</td>
							<td width=50px align="right" id="surcharge1"></td>
						</tr>
						<tr>
							<td width=130px align="left">Discount/Giảm giá</td>
							<td width=50px align="right" id="discount1"></td>
						</tr>
						<tr>
							<td width=130px align="left"><b>Total/Tổng tiền</b></td>
							<td width=50px align="right"><b id="total1"></b></td>
						</tr>
					</table>
................................................................................................
					<br>
I AGREE TO PAY THE ABOVE
					<br>
TOTAL AMOUNT ACCORDING TO
					<br>
CARD ISSUER AGREEMENT/TÔI
					<br>
ĐỒNG Ý THANH TOÁN TỔNG SỐ
					<br>
TIỀN TRÊN HÓA ĐƠN.
					<br>
NO REFUND/KHÔNG HOÀN TIỀN
					<br>
................................................................................................
				</p>
			</div>
			<div>
				<button id="print" class="button1" onclick="print()">IN</button>
			</div>
		</main>
		<script>
			const scanner = new Html5QrcodeScanner("reader",
			{
				qrbox:
				{
					width: 500,
					height: 500,
				},
				fps: 20,
				videoConstraints:
				{
                    facingMode: { exact: "environment" },
                },
			});
			scanner.render(success, error);
			function success(result)
			{
				scanner.clear();
				document.getElementById("reader").remove();
				try
				{
					const obj = JSON.parse(result);
					document.getElementById("code").value = obj.order_id;
					document.getElementById("name").value = obj.driver_name;
					document.getElementById("plate").value = obj.vehicle_license_plate;
					document.getElementById("distance").value = obj.distance_display.slice(0, -2);
					document.getElementById("fee").value = 1000 * parseInt(obj.base_fee_display.slice(0, -1));
					document.getElementById("addon").value = 1000 * parseInt(obj.addons_fee_display.slice(0, -1));
					document.getElementById("surcharge").value = 1000 * parseInt(obj.surcharge_fee_display.slice(0, -1));
					document.getElementById("discount").value = 1000 * parseInt(obj.discount_display.slice(0, -1));
					document.getElementById("result").style.display = "block";
				}
				catch(err)
				{
					alert("QR không hợp lệ");
				}
			}
			function error(result)
			{
			}
			function create()
			{
				var distance;
				var fee;
				var addon;
				var surcharge;
				var discount;
				if(document.getElementById("fee").value === "") fee = 0;
				else if(document.getElementById("fee").value < 0) fee = 0;
				else fee = document.getElementById("fee").value;
				if(document.getElementById("addon").value === "") addon = 0;
				else if(document.getElementById("addon").value < 0) addon = 0;
				else addon = document.getElementById("addon").value;
				if(document.getElementById("surcharge").value === "") surcharge = 0;
				else if(document.getElementById("surcharge").value < 0) surcharge = 0;
				else surcharge = document.getElementById("surcharge").value;
				if(document.getElementById("discount").value === "") discount = 0;
				else if(document.getElementById("discount").value > 0) discount = 0;
				else discount = document.getElementById("discount").value;
				if(document.getElementById("distance").value === "") distance = 0;
				else if(document.getElementById("distance").value < 0) distance = 0;
				else distance = document.getElementById("distance").value;
				var total = parseInt(fee) + parseInt(addon) + parseInt(surcharge) + parseInt(discount);
				document.getElementById("code1").innerHTML = document.getElementById("code").value;
				document.getElementById("name1").innerHTML = document.getElementById("name").value;
				var plate = document.getElementById("plate").value;
				document.getElementById("plate1").innerHTML = plate.substring(0, 7) + "<br>" + plate.substring(7);
				document.getElementById("distance1").innerHTML = distance.toString() + "km";
				var newmoney;
				var money = fee.toString() + "đ";
				if(money.length > 7) newmoney = money.slice(0, -7) + "." + money.slice(-7,-4) + "." + money.slice(-4);
				else if(money.length > 4) newmoney = money.slice(0, -4) + "." + money.slice(-4);
				else newmoney = money;
				document.getElementById("fee1").innerHTML = newmoney;
				money = discount.toString() + "đ";
				if(money.length > 7) newmoney = money.slice(0, -7) + "." + money.slice(-7,-4) + "." + money.slice(-4);
				else if(money.length > 4) newmoney = money.slice(0, -4) + "." + money.slice(-4);
				else newmoney = money;
				document.getElementById("discount1").innerHTML = newmoney;
				money = total.toString() + "đ";
				if(money.length > 7) newmoney = money.slice(0, -7) + "." + money.slice(-7,-4) + "." + money.slice(-4);
				else if(money.length > 4) newmoney = money.slice(0, -4) + "." + money.slice(-4);
				else newmoney = money;
				document.getElementById("total1").innerHTML = newmoney;
				money = addon.toString() + "đ";
				if(money.length > 7) newmoney = money.slice(0, -7) + "." + money.slice(-7,-4) + "." + money.slice(-4);
				else if(money.length > 4) newmoney = money.slice(0, -4) + "." + money.slice(-4);
				else newmoney = money;
				document.getElementById("addon1").innerHTML = newmoney;
				money = surcharge.toString() + "đ";
				if(money.length > 7) newmoney = money.slice(0, -7) + "." + money.slice(-7,-4) + "." + money.slice(-4);
				else if(money.length > 4) newmoney = money.slice(0, -4) + "." + money.slice(-4);
				else newmoney = money;
				document.getElementById("surcharge1").innerHTML = newmoney;
				var date = new Date();
				document.getElementById("time1").innerHTML = date.getDate().toString() + "/" + (date.getMonth()+1).toString() + "/" + date.getFullYear().toString() + "<br>" + date.getHours().toString() + ":" + date.getMinutes().toString();
				document.getElementById("result").remove();
				document.getElementById("bill").style.display = "block";
				document.getElementById("print").style.display = "block";
			}
			function print()
			{
				const bill = document.getElementById("bill");
				html2pdf().from(bill).set({
					margin: [8, 4, 2, 4],
					filename: "hoadon.pdf",
					html2canvas:
					{
						scale: window.devicePixelRatio,
					},
					jsPDF:
					{
						unit: "mm",
						format: [56, 142],
						orientation: "portrait"
					}
				}).save();
			}
		</script>
	</body>
</html>






















